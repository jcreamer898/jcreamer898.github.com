{"componentChunkName":"component---src-templates-post-tsx","path":"/how-webpack-decides-what-entry-to-load-from-a-package-json/","webpackCompilationHash":"911e3fa23554edb71338","result":{"data":{"logo":null,"markdownRemark":{"html":"<p>Today I was working on creating a node.js bundle using webpack 4, and came across a fun little doozie of an error which lead me to do a bit of code spelunkery into how Webpack actually decides on what to load when you <code class=\"language-text\">require</code> something from <code class=\"language-text\">node_modules</code>.</p>\n<p>Most <code class=\"language-text\">package.json</code> files have a <code class=\"language-text\">main</code> in them, because it tells the “requirer” of the package what the entry point of the package is.</p>\n<blockquote>\n<p>The main field is a module ID that is the primary entry point to your program. <a href=\"https://docs.npmjs.com/files/package.json#main\">https://docs.npmjs.com/files/package.json#main</a></p>\n</blockquote>\n<p>Well, there’s also a spec for defining other targets, namely the “browser” field.</p>\n<p><a href=\"https://docs.npmjs.com/files/package.json#browser\">https://docs.npmjs.com/files/package.json#browser</a></p>\n<p>There is even a proposal to add a “module” field. <a href=\"https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md\">https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md</a>, which some libraries are already taking advantage of, and Webpack can also understand it.</p>\n<p>In terms of Webpack, the 3 most important ones are <code class=\"language-text\">main</code>, <code class=\"language-text\">browser</code>, and <code class=\"language-text\">module</code>. </p>\n<ul>\n<li><code class=\"language-text\">browser</code> should point to a browser compatible bundle</li>\n<li><code class=\"language-text\">module</code> should point to a folder of ES modules</li>\n<li><code class=\"language-text\">main</code> should point to whatever whatever you want the default entry to be</li>\n</ul>\n<p>If the <code class=\"language-text\">target</code> of your app is <code class=\"language-text\">web</code> or a few others (which is default). It will look first at the <code class=\"language-text\">browser</code> field, and if it doesn’t exist, it’ll look for the <code class=\"language-text\">module</code>, and lastly <code class=\"language-text\">main</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">if (\n    options.target === &quot;web&quot; ||\n    options.target === &quot;webworker&quot; ||\n    options.target === &quot;electron-renderer&quot;\n) {\n    return [&quot;browser&quot;, &quot;module&quot;, &quot;main&quot;];\n} else {\n    return [&quot;module&quot;, &quot;main&quot;];\n}</code></pre></div>\n<p><a href=\"https://github.com/webpack/webpack/blob/52184b897f40c75560b3630e43ca642fcac7e2cf/lib/WebpackOptionsDefaulter.js#L336\">https://github.com/webpack/webpack/blob/52184b897f40c75560b3630e43ca642fcac7e2cf/lib/WebpackOptionsDefaulter.js#L336</a>.</p>\n<p>If your package is simply only meant to work in the browser, you can get away with only using <code class=\"language-text\">main</code>, but if you’re looking to support both the web and node, then take advantage of the <code class=\"language-text\">browser</code> field by pointing it to your browser compatible bundle.</p>\n<p>For me what was happening was, there’s an import in one of our libraries for <code class=\"language-text\">isomorphic-fetch</code>. Well, since the target is <code class=\"language-text\">node</code> in the Webpack build I was working with, <code class=\"language-text\">node-fetch</code> actually got required. And <code class=\"language-text\">node-fetch</code> requires a library which can’t be lazily loaded by Webpack. Aka this issue. <a href=\"https://github.com/andris9/encoding/issues/18\">https://github.com/andris9/encoding/issues/18</a>. </p>\n<p><strong>tldr; if your Webpack target is <code class=\"language-text\">node</code>, it looks at the <code class=\"language-text\">module</code> and <code class=\"language-text\">main</code> for entry. Otherwise, it goes to the <code class=\"language-text\">browser</code>, then <code class=\"language-text\">module</code>, then <code class=\"language-text\">main</code>.</strong></p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Today I was working on creating a node.js bundle using webpack 4, and came across a fun little doozie of an error which lead me to do a bit of code spelunkery into how Webpack actually decides on what to load when you "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"require"}]},{"type":"text","value":" something from "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"node_modules"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Most "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"package.json"}]},{"type":"text","value":" files have a "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" in them, because it tells the “requirer” of the package what the entry point of the package is."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The main field is a module ID that is the primary entry point to your program. "},{"type":"element","tagName":"a","properties":{"href":"https://docs.npmjs.com/files/package.json#main"},"children":[{"type":"text","value":"https://docs.npmjs.com/files/package.json#main"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Well, there’s also a spec for defining other targets, namely the “browser” field."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://docs.npmjs.com/files/package.json#browser"},"children":[{"type":"text","value":"https://docs.npmjs.com/files/package.json#browser"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is even a proposal to add a “module” field. "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md"},"children":[{"type":"text","value":"https://github.com/dherman/defense-of-dot-js/blob/master/proposal.md"}]},{"type":"text","value":", which some libraries are already taking advantage of, and Webpack can also understand it."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In terms of Webpack, the 3 most important ones are "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"browser"}]},{"type":"text","value":", and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"module"}]},{"type":"text","value":". "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"browser"}]},{"type":"text","value":" should point to a browser compatible bundle"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"module"}]},{"type":"text","value":" should point to a folder of ES modules"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" should point to whatever whatever you want the default entry to be"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"target"}]},{"type":"text","value":" of your app is "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"web"}]},{"type":"text","value":" or a few others (which is default). It will look first at the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"browser"}]},{"type":"text","value":" field, and if it doesn’t exist, it’ll look for the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"module"}]},{"type":"text","value":", and lastly "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"if (\n    options.target === \"web\" ||\n    options.target === \"webworker\" ||\n    options.target === \"electron-renderer\"\n) {\n    return [\"browser\", \"module\", \"main\"];\n} else {\n    return [\"module\", \"main\"];\n}"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/webpack/webpack/blob/52184b897f40c75560b3630e43ca642fcac7e2cf/lib/WebpackOptionsDefaulter.js#L336"},"children":[{"type":"text","value":"https://github.com/webpack/webpack/blob/52184b897f40c75560b3630e43ca642fcac7e2cf/lib/WebpackOptionsDefaulter.js#L336"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If your package is simply only meant to work in the browser, you can get away with only using "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":", but if you’re looking to support both the web and node, then take advantage of the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"browser"}]},{"type":"text","value":" field by pointing it to your browser compatible bundle."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For me what was happening was, there’s an import in one of our libraries for "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"isomorphic-fetch"}]},{"type":"text","value":". Well, since the target is "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"node"}]},{"type":"text","value":" in the Webpack build I was working with, "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"node-fetch"}]},{"type":"text","value":" actually got required. And "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"node-fetch"}]},{"type":"text","value":" requires a library which can’t be lazily loaded by Webpack. Aka this issue. "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/andris9/encoding/issues/18"},"children":[{"type":"text","value":"https://github.com/andris9/encoding/issues/18"}]},{"type":"text","value":". "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"tldr; if your Webpack target is "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"node"}]},{"type":"text","value":", it looks at the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"module"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" for entry. Otherwise, it goes to the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"browser"}]},{"type":"text","value":", then "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"module"}]},{"type":"text","value":", then "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":"."}]}]}],"data":{"quirksMode":false}},"excerpt":"Today I was working on creating a node.js bundle using webpack 4, and came across a fun little doozie of an error which lead me to do a bit…","timeToRead":2,"frontmatter":{"title":"How webpack decides what entry to load from a package","userDate":"30 September 2018","date":"2018-09-30T07:03:47.149Z","tags":["webpack","entry","package"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFA//EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAF9fKaNcYC//8QAHRAAAQMFAQAAAAAAAAAAAAAAAQIDIgAEERITIf/aAAgBAQABBQJcU9dQAALhcs0z6z//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwGI/8QAGxAAAgIDAQAAAAAAAAAAAAAAABEBUQIQIWH/2gAIAQEABj8CjpPpDQq1i6P/xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhMUFR/9oACAEBAAE/IV4K3b8Gqkzq6QBTV4Onwg2JhUf/2gAMAwEAAgADAAAAEFAP/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EG4U/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARIf/aAAgBAgEBPxAVqf/EABsQAQADAAMBAAAAAAAAAAAAAAEAETEhQVGR/9oACAEBAAE/ELSFrfSDmoxy4XhOHeeryW0AWw32T7SXbu4ppVD1iRBABfJ//9k=","aspectRatio":1.5,"src":"/static/2823decbecd34c6071cef2221f03b4ff/90537/testimg-cover.jpg","srcSet":"/static/2823decbecd34c6071cef2221f03b4ff/f8f18/testimg-cover.jpg 930w,\n/static/2823decbecd34c6071cef2221f03b4ff/90537/testimg-cover.jpg 1080w","sizes":"(max-width: 1080px) 100vw, 1080px"}}},"author":{"id":"Jonathan Creamer","bio":"Me","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEEBQL/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgD/2gAMAwEAAhADEAAAActrV9qLdVM0grsJ/8QAHBAAAwACAwEAAAAAAAAAAAAAAAECAxESExQx/9oACAEBAAEFAtbdQ5FyPOoJ1WXoPpeNEU5X/8QAFREBAQAAAAAAAAAAAAAAAAAAIEH/2gAIAQMBAT8Bg//EABURAQEAAAAAAAAAAAAAAAAAACBB/9oACAECAQE/AaP/xAAcEAACAgIDAAAAAAAAAAAAAAAAAREhEBIyQXH/2gAIAQEABj8CotM7NtlRDcenNYkhH//EABsQAAMBAQEBAQAAAAAAAAAAAAABESExQXHh/9oACAEBAAE/IXEtXFgxiH0acye99GW89b0r9BdUt7tg/OxM/9oADAMBAAIAAwAAABC00Lz/xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAEDAQE/EAKdXv8A/8QAGBEBAQADAAAAAAAAAAAAAAAAAQAQETH/2gAIAQIBAT8QeC0Rj//EABwQAQEBAAIDAQAAAAAAAAAAAAERACFhMUFRcf/aAAgBAQABPxBlr4D8ayj6BhEYHiXTraYESvzrU3hwXOlcQIp9N4SRFRE4TNcD0niU0SUxTo3/2Q==","width":400,"height":400,"src":"/static/7939bd0f614e75f5bf8544668e3f2971/f4032/me.jpg","srcSet":"/static/7939bd0f614e75f5bf8544668e3f2971/f4032/me.jpg 1x,\n/static/7939bd0f614e75f5bf8544668e3f2971/9429d/me.jpg 1.5x,\n/static/7939bd0f614e75f5bf8544668e3f2971/67481/me.jpg 2x"}}]}}}},"relatedPosts":{"totalCount":2,"edges":[{"node":{"id":"34dd7502-2118-5900-b774-7837016a254d","timeToRead":2,"excerpt":"Today I was working on creating a node.js bundle using webpack 4, and came across a fun little doozie of an error which lead me to do a bit…","frontmatter":{"title":"How webpack decides what entry to load from a package"},"fields":{"slug":"/how-webpack-decides-what-entry-to-load-from-a-package-json/"}}},{"node":{"id":"4ddd7533-e41a-5b4f-9e9e-0bd85b8ae796","timeToRead":3,"excerpt":"A revelation came to me the other day when I was reviewing some of our bundling processes at Eventbrite. We currently run production bundles…","frontmatter":{"title":"WebPack production environment is NOT the NODE_ENV or BABEL_ENV environment variable"},"fields":{"slug":"/webpack-production-environment-is-not-the-node_env-or-babel_env-environment-variable/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/how-webpack-decides-what-entry-to-load-from-a-package-json/","prev":null,"next":{"excerpt":"A revelation came to me the other day when I was reviewing some of our bundling processes at Eventbrite. We currently run production bundles…","timeToRead":3,"frontmatter":{"title":"WebPack production environment is NOT the NODE_ENV or BABEL_ENV environment variable","tags":["webpack","babel","node"],"date":"2018-09-30T07:03:47.149Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.506276150627615,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAdNuKx1yIr//xAAbEAADAAIDAAAAAAAAAAAAAAAAAQMCEQQSE//aAAgBAQABBQKVMVXkV6r1yENm9H//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwFn/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAESMRARIv/aAAgBAQAGPwJ9KOhRLKKx/8QAGhABAQACAwAAAAAAAAAAAAAAAQARITFBUf/aAAgBAQABPyHgCHDEJ7d5JdqPFl6QtC//2gAMAwEAAgADAAAAEC/P/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERIf/aAAgBAwEBPxCKY//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxBO2t//xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhcTFB8f/aAAgBAQABPxC41A0D99gqbNHh8ls10JY1OwEGHWCW0cn/2Q==","sizes":"(max-width: 1080px) 100vw, 1080px","src":"/static/8bafcea43f0bc141b01ef5b43dd2003b/90537/testimg1.jpg","srcSet":"/static/8bafcea43f0bc141b01ef5b43dd2003b/f8f18/testimg1.jpg 930w,\n/static/8bafcea43f0bc141b01ef5b43dd2003b/90537/testimg1.jpg 1080w"}}},"author":{"id":"Jonathan Creamer","bio":"Me","avatar":{"children":[{"fixed":{"src":"/static/7939bd0f614e75f5bf8544668e3f2971/f4032/me.jpg"}}]}}},"fields":{"layout":"post","slug":"/webpack-production-environment-is-not-the-node_env-or-babel_env-environment-variable/"}},"primaryTag":"webpack"}}}